(function(e,k){e.fn.moTree=function(l,m){var b=this,g=e.extend({},{initExpanded:!1,autoCollapse:!1,autoSelectFirst:!1,nodeAnimation:!0,animateSpeed:"fast",nodeTooltip:!1,selectedClass:"node-selected",hoverClass:"",defaultClass:"",onClick:null,onNodeCreate:null,target:"",autoSelectNonEmpty:!1,imagePath:"css/images/"},m);window.location.href.replace("[#?].*$","").replace(/[^\/]+$/,"");b.$selectedNode=null;b.nodes=[];b.$uls=[];b.data=l;b.hoverNode=null;b.playAnimation=function(a){if(g.nodeAnimation)return a?
a.children("ul").slideToggle(g.animateSpeed):(g.autoCollapse&&e(".mo-tree-expanded > ul",b).each(function(){var a=e(this);0==e("."+g.selectedClass,a).length&&(a.is(":visible")?a.slideUp(g.animateSpeed):a.hide())}),b.$selectedNode&&(b.$selectedNode.parents(".mo-tree-collapsed > ul").slideDown(g.animateSpeed),b.$selectedNode.parent().children("ul").slideDown(g.animateSpeed))),b};b.selectNodeByIdx=function(a){if(b.$selectedNode){if(a==b.$selectedNode.prop("idx"))return;b.$selectedNode.removeClass(g.selectedClass)}b.nodes[a]||
b.createNodes(b.findParentIdx(a));a=e(b.nodes[a]);return b.selectNode(a)};b.selectNode=function(a){b.$selectedNode&&b.$selectedNode.removeClass(g.selectedClass);b.$selectedNode=a.addClass(g.selectedClass);b.expandNode(a);return a};b.expandNode=function(a){b.createNodes(a.prop("idx"));b.playAnimation();g.autoCollapse&&e(".mo-tree-expanded",b).toggleClass("mo-tree-expanded").toggleClass("mo-tree-collapsed");a.parents(".mo-tree-collapsed").toggleClass("mo-tree-expanded").toggleClass("mo-tree-collapsed");
return b};b.toggleExpend=function(a){var c=a.siblings("a");b.createNodes(c.prop("idx"));a=a.parent();b.playAnimation(a);a.toggleClass("mo-tree-expanded").toggleClass("mo-tree-collapsed")};b.expandAll=function(a){var c=b.data,a=a==k?99:a;for(i=0;i<c.tl.length;i++)if(c.tl[i]<=a&&c.tl[i]<c.tl[i+1]){b.nodes[i+1]||b.createNodes(i);var d=e(b.nodes[i].parentNode);d.hasClass("mo-tree-collapsed")&&d.removeClass("mo-tree-collapsed").addClass("mo-tree-expanded").children("UL").slideDown(g.animateSpeed)}return b};
b.collapseAll=function(){for(i=0;i<b.$uls.length;i++){var a=b.$uls[i],c=a.parent();c.hasClass("mo-tree-expanded")&&(c.removeClass("mo-tree-expanded").addClass("mo-tree-collapsed"),a.slideUp(g.animateSpeed))}return b};b.nextNode=function(a,c,d){a||(a=b.$selectedNode);var f=b.data,a=a?parseInt(a.prop("idx"))+1:-1;if(0>a||a>f.tl.length)return null;for(;c&&"#"==f.ps[a];)if(a++,a>f.tl.length-1)return null;a=e(b.nodes[a]);d&&a.click();return a};b.prevNode=function(a,c,d){a||(a=b.$selectedNode);var f=b.data,
a=a?parseInt(a.prop("idx"))-1:-1;if(0>a||a>f.tl.length)return null;for(;c&&"#"==f.ps[a];)if(a--,0>a)return null;a=e(b.nodes[a]);d&&a.click();return a};b.createObject=function(a,b){var d=document.createElement(b);a.appendChild(d);return d};b.createNode=function(a,c){var d=b.data,f=d.tl[c];if(0<!f)return"";var e=d.ps[c],j;j=d.tl[c+1]>f?g.initExpanded?"mo-tree-folder mo-tree-expanded":"mo-tree-folder mo-tree-collapsed":"mo-tree-topic";var h=b.createObject(a,"LI");h.className=j;h.idx=c;h.level=f;f=g.target;
"#"==e&&(f="",e="javascript:void(0)");d=0<d.ns.length?d.ns[c]+" "+d.ts[c]:d.ts[c];h.innerHTML='<img class="mo-tree-icon" src="{0}" />'.format(g.imagePath+"mo-tree-n.gif")+'<a class="{0}" href="{1}" target="{2}">{4}</a>'.format("",e,f,c,d);e=h.childNodes[1];e.idx=c;return e};b.findParentIdx=function(a){for(var c=b.data.tl,d=c[a];c[a]>=d&&0<=a;)a--;return a};b.createNodes=function(a){if(!(0<=a&&b.nodes[a+1])){var c=b.data,d,f;0>a?(f=b.get(0),a=1,d=0):(b.nodes[a]||b.createNodes(b.findParentIdx(a)),f=
b.nodes[a].parentNode,a=parseInt(f.level)+1,d=parseInt(f.idx)+1);f=b.createObject(f,"UL");for(b.$uls[b.$uls.length]=e(f);c.tl[d]>=a;)c.tl[d]==a&&(b.nodes[d]=b.createNode(f,d)),d++}};b.init=function(){b.unbind();b.click(function(a){a=a.target;"A"==a.tagName?b.selectNode(e(a)):"IMG"==a.tagName&&b.toggleExpend(e(a))}).mouseover(function(a){e(b.hoverNode).removeClass(g.hoverClass);b.hoverNode=null;a=a.target;"A"==a.tagName&&a!=b.hoverNode&&(e(a).addClass(g.hoverClass),b.hoverNode=a)});b.html("");b.createNodes(-1);
return b};return b.init()}})(jQuery);
